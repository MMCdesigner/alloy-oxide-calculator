<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>at% ‚Üí wt% Calculator</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">

<style>
    body {
        font-family: "Roboto", sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
    }

    .container {
        max-width: 900px;
        margin: 40px auto;
        background: white;
        padding: 24px;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    h2 {
        font-weight: 500;
        text-align: center;
        margin-bottom: 20px;
    }

    .table-container {
        overflow-x: auto;
    }

    table {
        border-collapse: collapse;
        width: 100%;
        min-width: 550px; 
    }

    th, td {
        padding: 12px;
        text-align: center;
        border-bottom: 1px solid #ddd;
    }

    /* Composition Ê¨Ñ‰ΩçÂ∞àÁî®Ê®£Âºè */
    .comp-column {
        width: 120px;
        min-width: 120px;
    }

    /* at% Ê¨Ñ‰ΩçÂ∞àÁî®Ê®£Âºè */
    .at-column {
        width: 80px;
        min-width: 80px;
    }
    
    select, input[type=number], input[type=text] { /* Â¢ûÂä† input[type=text] */
        width: 100%;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 16px;
    }

    button {
        border: none;
        padding: 12px 20px;
        font-size: 16px;
        border-radius: 8px;
        margin: 8px 4px;
        cursor: pointer;
        transition: 0.2s;
    }

    .btn-primary {
        background-color: #1976d2;
        color: white;
    }

    .btn-primary:hover {
        background-color: #0d47a1;
    }

    .btn-normalize {
        background-color: #00796b;
        color: white;
    }

    .btn-normalize:hover {
        background-color: #004d40;
    }

    .btn-delete {
        background-color: #d32f2f;
        color: white;
        padding: 6px 10px;
    }

    .total-box {
        margin-top: 10px;
        font-size: 18px;
        font-weight: 500;
        text-align: right;
    }

    /* Êñ∞Â¢ûÂ≠ó‰∏≤ÁîüÊàêÂçÄÂ°äÊ®£Âºè */
    .string-generator {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #ccc;
    }

    .string-output {
        margin-top: 15px;
        padding: 10px;
        background-color: #e9e9e9;
        border-radius: 6px;
        font-size: 16px;
        word-break: break-all;
    }
</style>
</head>
<body>

<div class="container">
    <h2>Metal Oxide Composition CalculatorÔºàat% ‚Üí wt%Ôºâ</h2>

    <div class="table-container">
    <table id="elementsTable">
        <tr>
            <th class="comp-column">Composition</th> 
            <th class="at-column">at%</th>
            <th>wt%</th>
            <th>Delete</th>
        </tr>
    </table>
    </div>

    <button class="btn-primary" onclick="addRow()">Add Composition</button>
    <button class="btn-normalize" onclick="autoNormalize()">Normalize to 100%</button>
    <button class="btn-primary" onclick="calculate()">Calculate wt%</button>

    <div class="total-box">
        Total at%: <span id="totalAt">0</span>%
    </div>

    <div class="string-generator">
        <h3>üí¨ Ëá™ÂãïÁîüÊàêÂ≠ó‰∏≤ (‰æãÂ¶Ç: Ni 70 Pt 30)</h3>
        <input type="text" id="compositionInput" placeholder="Ë´ãËº∏ÂÖ•ÊàêÂàÜËàáÊØî‰æã (‰æãÂ¶Ç: Ni 70 Pt 30 Ru 0.5)" onchange="generateString()">
        
        <p>at% Â≠ó‰∏≤:</p>
        <div class="string-output" id="atStringOutput">-</div>
        
        <p>wt% Â≠ó‰∏≤:</p>
        <div class="string-output" id="wtStringOutput">-</div>
    </div>
    </div>

<script>
// Atomic weights
const atomicWeights = {
    "Al": 26.9815,
    "B": 10.81,
    "Co": 58.9332,
    "Cr": 51.9961,
    "Fe": 55.845,
    "Ni": 58.6934,
    "Pt": 195.084,
    "Ru": 101.07,
    "Ti": 47.867,
    "W": 183.84,
    "B2O3": 69.618,
    "CoO": 74.933,
    "Cr2O3": 151.99,
    "MgO": 40.304,
    "SiO2": 60.084,
    "TiO": 63.866,
    "TiO2": 79.866,
    "BN": 24.817,
};

// ... (‰ª•‰∏ãÊòØÂéüÊú¨ÁöÑÂáΩÊï∏ÔºåÁÇ∫‰øùÊåÅÁ®ãÂºèÁ¢ºÁ∞°ÊΩî‰∏çÈáçË§áË≤º‰∏äÔºå‰ΩÜÂú®ÂØ¶ÈöõÊ™îÊ°à‰∏≠ÈúÄ‰øùÁïô) ...

function addRow() {
    let table = document.getElementById("elementsTable");
    let row = table.insertRow(-1);

    // Composition
    let cell1 = row.insertCell(0);
    cell1.classList.add("comp-column");
    let select = document.createElement("select");
    for (let key in atomicWeights) {
        let opt = document.createElement("option");
        opt.value = key;
        opt.innerHTML = key;
        select.appendChild(opt);
    }
    cell1.appendChild(select);

    // at%
    let cell2 = row.insertCell(1);
    cell2.classList.add("at-column"); 
    let input = document.createElement("input");
    input.type = "number";
    input.value = 0;
    input.min = 0;
    input.oninput = updateTotalAt;
    cell2.appendChild(input);

    // wt%
    row.insertCell(2).innerHTML = "-";

    // delete
    let cell4 = row.insertCell(3);
    let del = document.createElement("button");
    del.className = "btn-delete";
    del.innerHTML = "X";
    del.onclick = () => { row.remove(); updateTotalAt(); };
    cell4.appendChild(del);
}

function updateTotalAt() {
    let rows = document.getElementById("elementsTable").rows;
    let total = 0;

    for (let i = 1; i < rows.length; i++) {
        let v = parseFloat(rows[i].cells[1].children[0].value);
        total += isNaN(v) ? 0 : v;
    }

    document.getElementById("totalAt").innerHTML = total.toFixed(3);
    return total;
}

function autoNormalize() {
    let total = updateTotalAt();
    if (total === 0) return;

    let rows = document.getElementById("elementsTable").rows;

    for (let i = 1; i < rows.length; i++) {
        let input = rows[i].cells[1].children[0];
        let val = parseFloat(input.value);
        input.value = ((val / total) * 100).toFixed(3);
    }

    updateTotalAt();
}

function calculate() {
    let rows = document.getElementById("elementsTable").rows;

    let nums = [], total = 0;
    for (let i = 1; i < rows.length; i++) {
        let elm = rows[i].cells[0].children[0].value;
        let at = parseFloat(rows[i].cells[1].children[0].value);
        let AW = atomicWeights[elm];
        let v = at * AW;
        nums.push(v);
        total += v;
    }

    for (let i = 1; i < rows.length; i++) {
        let wt = (nums[i - 1] / total) * 100;
        rows[i].cells[2].innerHTML = wt.toFixed(3) + "%";
    }
}
// È†êË®≠Êñ∞Â¢û‰∏ÄË°å
addRow();


/**
 * Ëß£ÊûêËº∏ÂÖ•Â≠ó‰∏≤ (‰æãÂ¶Ç: Ni 70 Pt 30)ÔºåË®àÁÆó wt%Ôºå‰∏¶ÁîüÊàê at% Âíå wt% Â≠ó‰∏≤„ÄÇ
 */
function generateString() {
    const input = document.getElementById("compositionInput").value.trim();
    const parts = input.match(/([a-zA-Z0-9]+)\s*(\d+(\.\d+)?)/g); // ÂåπÈÖçÂÖÉÁ¥†ÂíåÊï∏Â≠ó

    const atCompositions = [];
    let totalAt = 0;
    let totalAW = 0;

    if (!parts || parts.length === 0) {
        document.getElementById("atStringOutput").innerHTML = "Ëº∏ÂÖ•Ê†ºÂºèÈåØË™§ÊàñÁÇ∫Á©∫„ÄÇ";
        document.getElementById("wtStringOutput").innerHTML = "-";
        return;
    }

    // 1. Ëß£ÊûêÊàêÂàÜÂíå at%ÔºåË®àÁÆóÁ∏ΩÂíå
    for (const part of parts) {
        const match = part.match(/([a-zA-Z0-9]+)\s*(\d+(\.\d+)?)/);
        if (match) {
            const element = match[1];
            const at = parseFloat(match[2]);

            if (isNaN(at) || at <= 0 || !(element in atomicWeights)) {
                document.getElementById("atStringOutput").innerHTML = "ÊàêÂàÜÊàñÊØî‰æãÁÑ°Êïà (Ë´ãÊ™¢Êü•ÂÖÉÁ¥†ÂêçÁ®±Êàñ at% ÂÄº)„ÄÇ";
                document.getElementById("wtStringOutput").innerHTML = "-";
                return;
            }

            atCompositions.push({ element, at });
            totalAt += at;
        }
    }

    if (totalAt === 0) {
        document.getElementById("atStringOutput").innerHTML = "at% Á∏ΩÂíåÁÇ∫Èõ∂„ÄÇ";
        document.getElementById("wtStringOutput").innerHTML = "-";
        return;
    }

    // 2. Ê≠£Ë¶èÂåñ at% ‰∏¶Ë®àÁÆó wt% Áõ∏ÈóúÊï∏ÂÄº (at * AW)
    const normalizedCompositions = [];
    const precision = 3; // Â∞èÊï∏‰ΩçÊï∏

    for (const comp of atCompositions) {
        const normalizedAt = (comp.at / totalAt) * 100;
        const AW = atomicWeights[comp.element];
        const at_times_AW = normalizedAt * AW;
        
        normalizedCompositions.push({
            element: comp.element,
            at: normalizedAt,
            at_times_AW: at_times_AW
        });
        totalAW += at_times_AW;
    }
    
    // 3. Ë®àÁÆó wt% ‰∏¶ÁîüÊàêÂ≠ó‰∏≤
    let atString = [];
    let wtString = [];
    
    for (const comp of normalizedCompositions) {
        // at% Â≠ó‰∏≤Ê†ºÂºè: 70Ni-30Pt
        atString.push(`${comp.at.toFixed(precision).replace(/\.?0+$/, '')}${comp.element}`);

        // wt% Ë®àÁÆó
        const wt = (comp.at_times_AW / totalAW) * 100;
        
        // wt% Â≠ó‰∏≤Ê†ºÂºè: 85.45Ni-14.55Pt
        wtString.push(`${wt.toFixed(precision).replace(/\.?0+$/, '')}${comp.element}`);
    }

    // 4. Ëº∏Âá∫ÁµêÊûú
    document.getElementById("atStringOutput").innerHTML = `${atString.join('-')} at%`;
    document.getElementById("wtStringOutput").innerHTML = `${wtString.join('-')} wt%`;
}
</script>

</body>
</html>
